<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AegisIQ Stock Ledger</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- App Styles -->
  <link rel="stylesheet" href="app.css">
</head>
<body>

<!-- ================= HEADER ================= -->
<header class="header">
  <nav class="nav-container">
    <div class="nav-content">
      <img src="logo.svg" alt="AegisIQ Stock Ledger" class="logo-img" />
      
      <!-- Desktop Navigation -->
      <div class="nav-links">
        <a href="#" class="nav-link active">Ledger</a>
        <a href="#" class="nav-link">Reports</a>
        <a href="#" class="nav-link">Audit</a>
      </div>

      <!-- Auth Buttons -->
      <!-- User Dropdown -->
      <div class="user-dropdown" id="userDropdown">
        <button class="user-trigger" id="userTrigger">
          <div class="user-avatar" id="userAvatar">--</div>
          <span class="user-name" id="userName">Loading...</span>
          <svg class="chevron" width="14" height="14" viewBox="0 0 24 24">
            <polyline points="6 9 12 15 18 9" fill="none" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
        <div class="user-menu" id="userMenu">
          <div class="user-menu-header">
            <span class="user-menu-email" id="userEmail"></span>
            <span class="user-menu-role" id="userRole"></span>
          </div>
          <div class="user-menu-divider"></div>
          <button class="user-menu-item danger" onclick="logout()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            Log out
          </button>
        </div>
      </div>

      <!-- Mobile Menu Toggle -->
      <button class="mobile-menu-toggle" id="mobileMenuToggle">
        <svg class="menu-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>

    <!-- Mobile Menu -->
    <div class="mobile-menu hidden" id="mobileMenu">
      <a href="#" class="mobile-nav-link">Ledger</a>
      <a href="#" class="mobile-nav-link">Reports</a>
      <a href="#" class="mobile-nav-link">Audit</a>
      <div class="mobile-auth">
        <button class="btn btn-outline full-width" onclick="logout()">Logout</button>
      </div>
    </div>
  </nav>
</header>

<!-- ================= MAIN APP ================= -->
<main>
  <section class="section-container">
    <div class="app-shell">
      
      <!-- Page Header -->
      <div class="page-header">
        <div class="page-header-text">
			<h1 class="app-title" id="entityName">Loading...</h1>
			<p class="app-subtitle" id="entityDetails">
				<span><strong>Entity ID:</strong> <span id="entityId"></span></span><br>
				<span><strong>Address:</strong> <span id="entityAddress"></span></span><br>
				<span><strong>Email:</strong> <span id="entityEmail"></span></span><br>
				<span><strong>Tel:</strong> <span id="entityPhone"></span></span>
			</p>
		</div>
        <div class="page-header-stats">
          <div class="stat-badge">
            <span class="stat-label">Total Shareholders</span>
            <span class="stat-value" id="totalShareholdersCount">0</span>
          </div>
          <div class="stat-badge">
            <span class="stat-label">Total Shares</span>
            <span class="stat-value" id="totalSharesCount">0</span>
          </div>
        </div>
      </div>

      <!-- ================= FILTER BAR ================= -->
      <div class="filters-container card">
        <div class="filter-group">
          <div class="search-wrapper">
            <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" id="searchInput" placeholder="Search ID or name..." oninput="applyFilters()" />
          </div>
          
          <select id="entityFilter" onchange="applyFilters()">
            <option value="">All Entities</option>
          </select>
          
          <select id="stockTypeFilter" onchange="handleStockTypeChange()">
            <option value="">All Stock Types</option>
          </select>
          
          <select id="seriesFilter" onchange="applyFilters()">
            <option value="">All Series</option>
          </select>
          
          <select id="statusFilter" onchange="applyFilters()">
            <option value="">All Status</option>
            <option value="ACTIVE">Active</option>
            <option value="INACTIVE">Inactive</option>
          </select>
        </div>
        
        <div class="filter-actions">
          <button class="btn btn-ghost" onclick="resetFilters()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18M3 12h18M3 18h18"></path>
            </svg>
            Reset
          </button>
          <button class="btn btn-primary" onclick="exportCSV()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Export CSV
          </button>
          <button class="btn btn-gold" onclick="openCreateShareholderModal()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Add Shareholder
          </button>
        </div>
      </div>

      <!-- ================= HOLDINGS MATRIX - DARK EXECUTIVE ================= -->
      <div class="card holdings-matrix">

        <!-- HEADER -->
        <div class="matrix-header">
          <div class="matrix-cell expand-toggle"></div>
          <div class="matrix-cell account-col">Account #</div>
          <div class="matrix-cell name-col">Shareholder Name</div>
          <div class="matrix-cell address-col">Address</div>
          <div class="matrix-cell common-col">Common</div>
          <div class="matrix-cell series-col">Series A</div>
          <div class="matrix-cell series-col">Series B</div>
          <div class="matrix-cell total-col">Total Shares</div>
          <div class="matrix-cell pct-col">%</div>
          <div class="matrix-cell actions-col"></div>
        </div>

        <!-- BODY - Populated by JS -->
        <div class="matrix-body" id="holdingsMatrixBody"></div>

        <!-- FOOTER TOTALS -->
        <div class="matrix-footer" id="holdingsMatrixFooter">
          <div class="matrix-cell expand-toggle"></div>
          <div class="matrix-cell account-col"></div>
          <div class="matrix-cell name-col">TOTALS</div>
          <div class="matrix-cell address-col"></div>
          <div class="matrix-cell common-col" id="footerCommon">0</div>
          <div class="matrix-cell series-col" id="footerSeriesA">0</div>
          <div class="matrix-cell series-col" id="footerSeriesB">0</div>
          <div class="matrix-cell total-col" id="footerTotal">0</div>
          <div class="matrix-cell pct-col">100%</div>
          <div class="matrix-cell actions-col"></div>
        </div>

      </div>

<!-- ================= TWO-PANE DETAIL DRAWER ================= -->
<div class="drawer-overlay" id="detailDrawer">
  <div class="drawer dark-exec">

    <!-- LEFT -->
    <aside class="drawer-left">
      <div class="drawer-profile">
        <div class="avatar">JH</div>
        <div>
          <div class="drawer-name" id="drawerName"></div>
          <div class="drawer-sub"></div>
        </div>
      </div>

      <div class="drawer-meta">
        <div class="meta-label">Address</div>
        <div class="meta-value" id="drawerAddress"></div>
      </div>

      <nav class="drawer-nav">
        <button class="drawer-tab active" onclick="switchDrawerTab('holdings', event)">
          Holdings
        </button>
        <button class="drawer-tab" onclick="switchDrawerTab('entries', event)">
          Book Entries
        </button>
      </nav>
    </aside>

    <!-- RIGHT -->
    <section class="drawer-right">

      <!-- HOLDINGS -->
      <div class="drawer-panel active" id="drawer-holdings">
        <div class="drawer-section">
          <div class="section-title"></div>
          <table class="drawer-table">
            <thead>
              <tr>
                <th>Book Entry ID</th>
                <th>Shares</th>
                <th>Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>

      <!-- ENTRIES -->
      <div class="drawer-panel" id="drawer-entries">
        <div class="empty-note">
          Select a holding to view book entries.
        </div>
      </div>

    </section>

    <button class="drawer-close" onclick="closeDrawer()">✕</button>
  </div>
</div>

    </div>
  </section>
</main>

<!-- ================= MODALS ================= -->

<!-- Create Shareholder Modal -->
<div class="modal-overlay" id="createShareholderModal">
  <div class="modal">
    <div class="modal-header">
      <h2>Create Shareholder</h2>
      <button class="modal-close" onclick="closeModal('createShareholderModal')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <form id="createShareholderForm" onsubmit="submitCreateShareholder(event)">
      <div class="form-group">
        <label>Full Name</label>
        <input type="text" id="shareholderName" placeholder="Enter full name" required />
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="shareholderEmail" placeholder="email@example.com" />
        </div>
        <div class="form-group">
          <label>Tax ID</label>
          <input type="text" id="shareholderTaxId" placeholder="XXX-XX-XXXX" />
        </div>
      </div>
      <div class="form-group">
        <label>Address</label>
        <input type="text" id="shareholderAddress" placeholder="Street address" />
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Entity</label>
          <select id="shareholderEntity" required></select>
        </div>
        <div class="form-group">
          <label>Type</label>
          <select id="shareholderType" required>
            <option value="INDIVIDUAL">Individual</option>
            <option value="ENTITY">Entity</option>
            <option value="TRUST">Trust</option>
          </select>
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-ghost" onclick="closeModal('createShareholderModal')">Cancel</button>
        <button type="submit" class="btn btn-primary">Create Shareholder</button>
      </div>
    </form>
  </div>
</div>

<!-- Issue Shares Modal -->
<div class="modal-overlay" id="issueSharesModal">
  <div class="modal">
    <div class="modal-header">
      <h2>Issue Shares</h2>
      <button class="modal-close" onclick="closeModal('issueSharesModal')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <form id="issueSharesForm" onsubmit="submitIssueShares(event)">
      <input type="hidden" id="issueShareholderId" />
      <div class="form-group">
        <label>Shareholder</label>
        <input type="text" id="issueShareholderName" readonly class="readonly-input" />
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Stock Type</label>
          <select id="issueStockType" onchange="updateIssueSeries()" required></select>
        </div>
        <div class="form-group">
          <label>Series</label>
          <select id="issueSeries"></select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Shares</label>
          <input type="number" id="issueShares" placeholder="Number of shares" min="1" required />
        </div>
        <div class="form-group">
          <label>Issue Date</label>
          <input type="date" id="issueDate" required />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Certificate #</label>
          <input type="text" id="issueCertificate" placeholder="Optional" />
        </div>
        <div class="form-group">
          <label>Price per Share</label>
          <input type="number" id="issuePricePerShare" placeholder="0.00" step="0.01" min="0" />
        </div>
      </div>
      <div class="form-group">
        <label>Notes</label>
        <textarea id="issueNotes" placeholder="Optional notes..."></textarea>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-ghost" onclick="closeModal('issueSharesModal')">Cancel</button>
        <button type="submit" class="btn btn-primary">Issue Shares</button>
      </div>
    </form>
  </div>
</div>

<!-- Transfer Shares Modal -->
<div class="modal-overlay" id="transferSharesModal">
  <div class="modal">
    <div class="modal-header">
      <h2>Transfer Shares</h2>
      <button class="modal-close" onclick="closeModal('transferSharesModal')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <form id="transferSharesForm" onsubmit="submitTransferShares(event)">
      <input type="hidden" id="transferFromId" />
      <div class="form-group">
        <label>From Shareholder</label>
        <input type="text" id="transferFromName" readonly class="readonly-input" />
      </div>
      <div class="form-group">
        <label>To Shareholder</label>
        <select id="transferToId" required></select>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Stock Type</label>
          <select id="transferStockType" onchange="updateTransferSeries()" required></select>
        </div>
        <div class="form-group">
          <label>Series</label>
          <select id="transferSeries"></select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Shares</label>
          <input type="number" id="transferShares" placeholder="Number of shares" min="1" required />
        </div>
        <div class="form-group">
          <label>Transfer Date</label>
          <input type="date" id="transferDate" required />
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-ghost" onclick="closeModal('transferSharesModal')">Cancel</button>
        <button type="submit" class="btn btn-primary">Transfer Shares</button>
      </div>
    </form>
  </div>
</div>

<!-- Book Entry Detail Drawer -->
<div class="drawer-overlay" id="bookEntryDrawer">
  <div class="drawer">
    <div class="drawer-header">
      <h2>Shareholder Details</h2>
      <button class="drawer-close" onclick="closeDrawer()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="drawer-content" id="drawerContent">
      <!-- Content will be injected -->
    </div>
  </div>
</div>

<!-- ================= TOAST CONTAINER ================= -->
<div id="toastContainer"></div>

<!-- ================= FOOTER ================= -->
<footer class="footer">
  <div class="footer-container">
    <div class="footer-bottom">
      <div class="footer-legal">
        <span>© 2026 AegisIQ. All rights reserved.</span>
        <span class="separator">|</span>
        <a href="#">Terms of Service</a>
        <span class="separator">|</span>
        <a href="mailto:support@aegisiqstockledger.com">support@aegisiqstockledger.com</a>
      </div>
      <button class="back-to-top" onclick="scrollToTop()">
        Back to Top
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="19" x2="12" y2="5"></line>
          <polyline points="5 12 12 5 19 12"></polyline>
        </svg>
      </button>
    </div>
  </div>
</footer>

<script src="app.js"></script>
</body>
</html>